name: Deploy

on:
  push:
    branches:
    - master
    tags: # Push events to new versions, e.g., 1.0, 20.15.10
    - "[0-9]+.[0-9]+"
    - "[0-9]+.[0-9]+.[0-9]+"
    - "[0-9]+.[0-9]+-*"
    - "[0-9]+.[0-9]+.[0-9]+-*"

jobs:
  push-frontend:
    name: "ðŸš€ Push frontend image"
    runs-on: ubuntu-18.04
    steps:
    - name: "ðŸ“¥ Check-out"
      uses: actions/checkout@v2
    - name: "ðŸš€ Build & push Docker image"
      uses: docker/build-push-action@v1
      with:
        registry: docker.pkg.github.com
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}
        repository: docker.pkg.github.com/${{ github.repository }}
        tag_with_ref: true
        path: frontend
        add_git_labels: true
  push-backend:
    name: "ðŸš€ Push backend image"
    runs-on: ubuntu-18.04
    steps:
    - name: "ðŸ“¥ Check-out"
      uses: actions/checkout@v2
    - name: "ðŸš€ Build & push Docker image"
      uses: docker/build-push-action@v1
      with:
        registry: docker.pkg.github.com
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}
        repository: docker.pkg.github.com/${{ github.repository }}
        tag_with_ref: true
        path: backend
        add_git_labels: true
